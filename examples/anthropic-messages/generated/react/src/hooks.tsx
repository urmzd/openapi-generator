// Auto-generated by oag — do not edit

import { useCallback, useRef, useState } from "react";
import useSWR, { type SWRConfiguration } from "swr";
import useSWRMutation, { type SWRMutationConfiguration } from "swr/mutation";
import { useApiClient } from "./provider";
import type {
  CountTokensRequest,
  CountTokensResponse,
  CreateMessageRequest,
  CreateMessageStreamEvent,
  MessageResponse,
  ModelInfo,
  ModelListResponse,
} from "./types";

/** Create a message */
export function useCreateMessageStream(anthropicVersion: string) {
  const client = useApiClient();
  const [events, setEvents] = useState<CreateMessageStreamEvent[]>([]);
  const [isStreaming, setIsStreaming] = useState(false);
  const [error, setError] = useState<Error | null>(null);
  const abortRef = useRef<AbortController | null>(null);

  const trigger = useCallback(
    async (body: CreateMessageRequest) => {
      setEvents([]);
      setError(null);
      setIsStreaming(true);
      abortRef.current = new AbortController();

      try {
        for await (const event of client.createMessageStream(anthropicVersion, body, {
          signal: abortRef.current.signal,
        })) {
          setEvents((prev) => [...prev, event]);
        }
      } catch (err) {
        if (err instanceof DOMException && err.name === "AbortError") {
          // Intentional abort — not an error
        } else {
          setError(err instanceof Error ? err : new Error(String(err)));
        }
      } finally {
        setIsStreaming(false);
        abortRef.current = null;
      }
    },
    [client, anthropicVersion],
  );

  const abort = useCallback(() => {
    abortRef.current?.abort();
  }, []);

  const reset = useCallback(() => {
    setEvents([]);
    setError(null);
  }, []);

  return { events, isStreaming, error, trigger, abort, reset };
}

/** Create a message */
export function useCreateMessage(
  anthropicVersion: string,
  config?: SWRMutationConfiguration<
    MessageResponse,
    Error,
    readonly [string, string],
    CreateMessageRequest
  >,
) {
  const client = useApiClient();
  return useSWRMutation<MessageResponse, Error, readonly [string, string], CreateMessageRequest>(
    ["/v1/messages", anthropicVersion] as const,
    (_key: readonly [string, string], { arg }: { arg: CreateMessageRequest }) =>
      client.createMessage(anthropicVersion, arg),
    config,
  );
}

/** Count tokens in a message */
export function useCountTokens(
  anthropicVersion: string,
  config?: SWRMutationConfiguration<
    CountTokensResponse,
    Error,
    readonly [string, string],
    CountTokensRequest
  >,
) {
  const client = useApiClient();
  return useSWRMutation<CountTokensResponse, Error, readonly [string, string], CountTokensRequest>(
    ["/v1/messages/count_tokens", anthropicVersion] as const,
    (_key: readonly [string, string], { arg }: { arg: CountTokensRequest }) =>
      client.countTokens(anthropicVersion, arg),
    config,
  );
}

/** List available models */
export function useListModels(
  anthropicVersion: string,
  limit?: number,
  afterId?: string,
  beforeId?: string,
  config?: SWRConfiguration<ModelListResponse>,
) {
  const client = useApiClient();
  return useSWR<ModelListResponse>(
    ["/v1/models", anthropicVersion, limit, afterId, beforeId] as const,
    () => client.listModels(anthropicVersion, limit, afterId, beforeId),
    config,
  );
}

/** Get details of a specific model */
export function useGetModel(
  anthropicVersion: string,
  modelId: string,
  config?: SWRConfiguration<ModelInfo>,
) {
  const client = useApiClient();
  return useSWR<ModelInfo>(
    ["/v1/models/{model_id}", anthropicVersion, modelId] as const,
    () => client.getModel(anthropicVersion, modelId),
    config,
  );
}

/** Cancel a message batch */
export function useCancelBatch(
  anthropicVersion: string,
  batchId: string,
  config?: SWRMutationConfiguration<void, Error, readonly [string, string, string], never>,
) {
  const client = useApiClient();
  return useSWRMutation<void, Error, readonly [string, string, string], never>(
    ["/v1/messages/batches/{batch_id}", anthropicVersion, batchId] as const,
    (_key: readonly [string, string, string]) => client.cancelBatch(anthropicVersion, batchId),
    config,
  );
}
