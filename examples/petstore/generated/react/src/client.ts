// Auto-generated by oag â€” do not edit
import type {
  CreatePetBody,
  CreatePetResponse,
  GetPetResponse,
  ListPetsResponseItem,
  UpdatePetBody,
  UpdatePetResponse,
} from "./types";

/** Options for API requests. */
export interface RequestOptions {
  signal?: AbortSignal;
  headers?: Record<string, string>;
}

/** Configuration for the API client. */
export interface ClientConfig {
  baseUrl: string;
  headers?: Record<string, string>;
  fetch?: typeof globalThis.fetch;
  requestInterceptor?: (request: {
    url: string;
    init: RequestInit;
  }) => { url: string; init: RequestInit } | Promise<{ url: string; init: RequestInit }>;
}

/** Error thrown when an API request returns a non-OK status. */
export class ApiError extends Error {
  constructor(
    message: string,
    public readonly statusCode: number,
    public readonly statusText: string,
    public readonly body?: unknown,
  ) {
    super(message);
    this.name = "ApiError";
  }
}

/** API client for Petstore. */
export class ApiClient {
  private readonly baseUrl: string;
  private readonly headers: Record<string, string>;
  private readonly fetchFn: typeof globalThis.fetch;
  private readonly requestInterceptor?: ClientConfig["requestInterceptor"];

  constructor(config: ClientConfig) {
    this.baseUrl = config.baseUrl.replace(/\/$/, "");
    this.headers = config.headers ?? {};
    this.fetchFn = config.fetch ?? globalThis.fetch.bind(globalThis);
    this.requestInterceptor = config.requestInterceptor;
  }

  private async request<T>(
    method: string,
    path: string,
    options?: RequestOptions & { body?: unknown; query?: Record<string, string | undefined> },
  ): Promise<T> {
    let url = `${this.baseUrl}${path}`;
    if (options?.query) {
      const params = new URLSearchParams();
      for (const [key, value] of Object.entries(options.query)) {
        if (value !== undefined && value !== null) {
          params.set(key, value);
        }
      }
      const qs = params.toString();
      if (qs) url += `?${qs}`;
    }

    let req = {
      url,
      init: {
        method,
        headers: {
          "Content-Type": "application/json",
          ...this.headers,
          ...options?.headers,
        } as Record<string, string>,
        body: options?.body !== undefined ? JSON.stringify(options.body) : undefined,
        signal: options?.signal,
      } as RequestInit,
    };

    if (this.requestInterceptor) {
      req = await this.requestInterceptor(req);
    }

    const response = await this.fetchFn(req.url, req.init);

    if (!response.ok) {
      let body: unknown;
      try {
        const text = await response.text();
        body = text ? JSON.parse(text) : undefined;
      } catch {
        // body remains undefined if not valid JSON
      }
      throw new ApiError(
        `API request failed: ${response.status} ${response.statusText}`,
        response.status,
        response.statusText,
        body,
      );
    }

    if (response.status === 204) {
      return undefined as T;
    }

    return response.json() as Promise<T>;
  }

  /** List all pets */
  async listPets(
    limit?: number,
    status?: "available" | "pending" | "sold",
    options?: RequestOptions,
  ): Promise<ListPetsResponseItem[]> {
    const path = "/pets";
    return this.request<ListPetsResponseItem[]>("GET", path, {
      query: {
        limit: limit != null ? String(limit) : undefined,
        status: status != null ? String(status) : undefined,
      },
      ...options,
    });
  }

  /** Create a pet */
  async createPet(body: CreatePetBody, options?: RequestOptions): Promise<CreatePetResponse> {
    const path = "/pets";
    return this.request<CreatePetResponse>("POST", path, {
      body,
      ...options,
    });
  }

  /** Get a pet by ID */
  async getPet(petId: string, options?: RequestOptions): Promise<GetPetResponse> {
    let path = "/pets/{petId}";
    path = path.replace("{petId}", encodeURIComponent(String(petId)));
    return this.request<GetPetResponse>("GET", path, {
      ...options,
    });
  }

  /** Update a pet */
  async updatePet(
    petId: string,
    body: UpdatePetBody,
    options?: RequestOptions,
  ): Promise<UpdatePetResponse> {
    let path = "/pets/{petId}";
    path = path.replace("{petId}", encodeURIComponent(String(petId)));
    return this.request<UpdatePetResponse>("PUT", path, {
      body,
      ...options,
    });
  }

  /** Delete a pet */
  async deletePet(petId: string, options?: RequestOptions): Promise<void> {
    let path = "/pets/{petId}";
    path = path.replace("{petId}", encodeURIComponent(String(petId)));
    await this.request<void>("DELETE", path, {
      ...options,
    });
  }

  /** Returns pet inventories by status */
  async getInventory(options?: RequestOptions): Promise<Record<string, number>> {
    const path = "/store/inventory";
    return this.request<Record<string, number>>("GET", path, {
      ...options,
    });
  }
}
