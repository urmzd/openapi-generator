// Auto-generated by oag â€” do not edit
import { describe, it, expect, vi } from "vitest";
import { ApiClient } from "./client";
import type { ClientConfig } from "./client";

import type { CreatePetBody, CreatePetResponse, GetPetResponse, ListPetsResponseItem, UpdatePetBody, UpdatePetResponse } from "./types";


function createMockFetch(status = 200, body: unknown = {}) {
  return vi.fn().mockResolvedValue({
    ok: status >= 200 && status < 300,
    status,
    statusText: status === 200 ? "OK" : "Error",
    json: () => Promise.resolve(body),
    text: () => Promise.resolve(JSON.stringify(body)),
    body: null,
  } as unknown as Response);
}

function createClient(fetchFn?: typeof globalThis.fetch): ApiClient {
  const config: ClientConfig = {
    baseUrl: "https://api.test.com",
    fetch: fetchFn ?? createMockFetch(),
  };
  return new ApiClient(config);
}

describe("ApiClient", () => {
  it("can be instantiated with config", () => {
    const client = createClient();
    expect(client).toBeInstanceOf(ApiClient);
  });

  it("can be instantiated with custom headers", () => {
    const config: ClientConfig = {
      baseUrl: "https://api.test.com",
      headers: { Authorization: "Bearer token" },
      fetch: createMockFetch(),
    };
    const client = new ApiClient(config);
    expect(client).toBeInstanceOf(ApiClient);
  });

  it("can be instantiated with custom fetch", () => {
    const mockFetch = createMockFetch();
    const client = createClient(mockFetch);
    expect(client).toBeInstanceOf(ApiClient);
  });



  describe("listPets", () => {
    it("method exists", () => {
      const client = createClient();
      expect(typeof client.listPets).toBe("function");
    });

    it("makes GET request to correct URL", async () => {
      const mockFetch = createMockFetch(200, []);
      const client = createClient(mockFetch);
      await client.listPets();
      expect(mockFetch).toHaveBeenCalledTimes(1);
      const [url, init] = mockFetch.mock.calls[0];
      expect(url).toContain("/pets");
      expect(init.method).toBe("GET");
    });


    it("throws on non-OK response", async () => {
      const mockFetch = createMockFetch(500);
      const client = createClient(mockFetch);
      await expect(client.listPets()).rejects.toThrow();
    });
  });




  describe("createPet", () => {
    it("method exists", () => {
      const client = createClient();
      expect(typeof client.createPet).toBe("function");
    });

    it("makes POST request to correct URL", async () => {
      const mockFetch = createMockFetch(200, {} as CreatePetResponse);
      const client = createClient(mockFetch);
      await client.createPet({} as CreatePetBody);
      expect(mockFetch).toHaveBeenCalledTimes(1);
      const [url, init] = mockFetch.mock.calls[0];
      expect(url).toContain("/pets");
      expect(init.method).toBe("POST");
    });


    it("sends request body", async () => {
      const mockFetch = createMockFetch(200, {} as CreatePetResponse);
      const client = createClient(mockFetch);
      await client.createPet({} as CreatePetBody);
      const [, init] = mockFetch.mock.calls[0];
      expect(init.body).toBeDefined();
    });


    it("throws on non-OK response", async () => {
      const mockFetch = createMockFetch(500);
      const client = createClient(mockFetch);
      await expect(client.createPet({} as CreatePetBody)).rejects.toThrow();
    });
  });




  describe("getPet", () => {
    it("method exists", () => {
      const client = createClient();
      expect(typeof client.getPet).toBe("function");
    });

    it("makes GET request to correct URL", async () => {
      const mockFetch = createMockFetch(200, {} as GetPetResponse);
      const client = createClient(mockFetch);
      await client.getPet("test");
      expect(mockFetch).toHaveBeenCalledTimes(1);
      const [url, init] = mockFetch.mock.calls[0];
      expect(url).toContain("/pets/test");
      expect(init.method).toBe("GET");
    });


    it("throws on non-OK response", async () => {
      const mockFetch = createMockFetch(500);
      const client = createClient(mockFetch);
      await expect(client.getPet("test")).rejects.toThrow();
    });
  });




  describe("updatePet", () => {
    it("method exists", () => {
      const client = createClient();
      expect(typeof client.updatePet).toBe("function");
    });

    it("makes PUT request to correct URL", async () => {
      const mockFetch = createMockFetch(200, {} as UpdatePetResponse);
      const client = createClient(mockFetch);
      await client.updatePet("test", {} as UpdatePetBody);
      expect(mockFetch).toHaveBeenCalledTimes(1);
      const [url, init] = mockFetch.mock.calls[0];
      expect(url).toContain("/pets/test");
      expect(init.method).toBe("PUT");
    });


    it("sends request body", async () => {
      const mockFetch = createMockFetch(200, {} as UpdatePetResponse);
      const client = createClient(mockFetch);
      await client.updatePet("test", {} as UpdatePetBody);
      const [, init] = mockFetch.mock.calls[0];
      expect(init.body).toBeDefined();
    });


    it("throws on non-OK response", async () => {
      const mockFetch = createMockFetch(500);
      const client = createClient(mockFetch);
      await expect(client.updatePet("test", {} as UpdatePetBody)).rejects.toThrow();
    });
  });




  describe("deletePet", () => {
    it("method exists", () => {
      const client = createClient();
      expect(typeof client.deletePet).toBe("function");
    });

    it("makes DELETE request to correct URL", async () => {
      const mockFetch = createMockFetch(204);
      const client = createClient(mockFetch);
      await client.deletePet("test");
      expect(mockFetch).toHaveBeenCalledTimes(1);
      const [url, init] = mockFetch.mock.calls[0];
      expect(url).toContain("/pets/test");
      expect(init.method).toBe("DELETE");
    });

    it("returns undefined on 204", async () => {
      const mockFetch = createMockFetch(204);
      const client = createClient(mockFetch);
      const result = await client.deletePet("test");
      expect(result).toBeUndefined();
    });
  });




  describe("getInventory", () => {
    it("method exists", () => {
      const client = createClient();
      expect(typeof client.getInventory).toBe("function");
    });

    it("makes GET request to correct URL", async () => {
      const mockFetch = createMockFetch(200, {} as Record<string, number>);
      const client = createClient(mockFetch);
      await client.getInventory();
      expect(mockFetch).toHaveBeenCalledTimes(1);
      const [url, init] = mockFetch.mock.calls[0];
      expect(url).toContain("/store/inventory");
      expect(init.method).toBe("GET");
    });


    it("throws on non-OK response", async () => {
      const mockFetch = createMockFetch(500);
      const client = createClient(mockFetch);
      await expect(client.getInventory()).rejects.toThrow();
    });
  });


});