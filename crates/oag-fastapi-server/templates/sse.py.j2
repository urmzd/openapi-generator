# Auto-generated by oag â€” do not edit
from __future__ import annotations

from collections.abc import AsyncGenerator
from typing import TypeVar

from fastapi.responses import StreamingResponse
from pydantic import BaseModel

T = TypeVar("T", bound=BaseModel)


async def sse_response(generator: AsyncGenerator[T, None]) -> StreamingResponse:
    """Wrap an async generator into an SSE StreamingResponse.

    Each yielded Pydantic model is serialized as a `data:` line.
    A final `data: [DONE]` sentinel is sent before closing.
    """

    async def event_stream() -> AsyncGenerator[str, None]:
        async for event in generator:
            data = event.model_dump_json()
            yield f"data: {data}\n\n"
        yield "data: [DONE]\n\n"

    return StreamingResponse(event_stream(), media_type="text/event-stream")
